name: Bismush
targets:
  BismushKit:
    type: framework
    platform: [macOS, iOS]
    scheme:
      testTargets:
        - BismushKit_UnitTests_${platform}
    info:
      path: Frameworks/BismushKit/Supports Files/Info.plist
    preBuildScripts:
      - path: Scripts/swiftformat.sh
        name: Swift Format
      - path: Scripts/clang-format.sh
        name: clang-format
    postCompileScripts:
      - script: Scripts/swiftlint.sh
        name: Swiftlint
    sources: 
      - Frameworks/BismushKit
    settings:
      MTL_LANGUAGE_REVISION: Metal24

  BismushKit_UnitTests:
    type: bundle.unit-test
    platform: [macOS, iOS]
    sources: 
      - Tests/UnitTests/BismushKit
    dependencies:
      - target: BismushKit_${platform}

  Bismush:
    type: application
    platform: macOS
    scheme:
      testTargets:
        - Bismush_UITests
        - Bismush_UnitTests
    dependencies:
      - target: BismushKit_macOS
    entitlements:
      path: Sources/Bismush/Supports Files/Bismush.entitlements
      properties:
        com.apple.security.app-sandbox: true
    info:
      path: Sources/Supports Files/Bismush/Info.plist
    preBuildScripts:
      - path: Scripts/swiftformat.sh
        name: Swift Format
    postCompileScripts:
      - script: Scripts/swiftlint.sh
        name: Swiftlint
    sources:
      - Sources/Bismush
  Bismush_UITests:
    type: bundle.ui-testing
    platform: macOS
    dependencies:
      - target: Bismush
    info:
      path: Tests/UITests/Bismush/Info.plist
    sources: 
      - Tests/UITests/Bismush
  Bismush_UnitTests:
    type: bundle.unit-test
    platform: macOS
    dependencies:
      - target: Bismush
    info:
      path: Tests/UITests/Bismush/Info.plist
    sources: 
      - Tests/UnitTests/Bismush
  MobileBismush:
    type: application
    platform: iOS
    dependencies:
      - target: BismushKit_iOS
    scheme:
      testTargets:
        - MobileBismush_UITests
        - MobileBismush_UnitTests
    info:
      path: Sources/MobileBismush/Supports Files/Info.plist
    entitlements:
      path: Sources/MobileBismush/Supports Files/MobileBismush.entitlements
      properties:
        com.apple.security.app-sandbox: true
    settings:
      SUPPORTS_MACCATALYST: true
    preBuildScripts:
      - path: Scripts/swiftformat.sh
        name: Swift Format
    postCompileScripts:
      - script: Scripts/swiftlint.sh
        name: Swiftlint
    sources: 
      - Sources/MobileBismush
  MobileBismush_UITests:
    type: bundle.ui-testing
    platform: iOS
    dependencies:
      - target: MobileBismush
    info:
      path: Tests/UITests/MobileBismush/Info.plist
    sources: 
      - Tests/UITests/MobileBismush
  MobileBismush_UnitTests:
    type: bundle.unit-test
    platform: iOS
    dependencies:
      - target: MobileBismush
    sources: 
      - Tests/UnitTests/MobileBismush

schemes:
  CI.macOS:
    build:
      targets:
        Bismush: all
    test:
      targets:
        - Bismush_UITests
        - Bismush_UnitTests
  CI.iOS:
    build:
      targets:
        MobileBismush: all
      config: CI
    test:
        targets:
            - MobileBismush_UITests
            - MobileBismush_UnitTests
        config: CI

configs:
  CI: debug
  Debug: debug
  Release: release
settings:
  base:
    DEVELOPMENT_TEAM: VG2YYSKSHY
    CODE_SIGN_STYLE: Automatic
    CODE_SIGN_IDENTITY: "-"
  configs:
    CI:
      DEVELOPMENT_TEAM:
      CODE_SIGN_STYLE: Manual
      CODE_SIGN_IDENTITY: "-"

options:
  bundleIdPrefix: jp.mzp.bismus

  createIntermediateGroups: true

  deploymentTarget:
    iOS: "14.0"
    macOS: "11.0"

  groupOrdering: 
    - order: [Sources, Frameworks, Tests, Scripts]

fileGroups:
  - README.md
  - project.yml
  - Scripts
  - BuildTools/.swiftlint.yml
  - BuildTools/Package.swift
  - .swiftformat
  - .github
  - .clang-format
